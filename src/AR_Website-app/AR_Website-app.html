<link rel='import' href='../../bower_components/polymer/polymer.html'>
<link rel='import' href='../../bower_components/app-route/app-location.html'>
<link rel='import' href='../../bower_components/app-route/app-route.html'>
<link rel='import' href='../../bower_components/iron-ajax/iron-ajax.html'>

<link rel='import' href='header-element.html'>
<link rel='import' href='article-element.html'>

<dom-module id='AR_Website-app'>
  <template>

    <style>
      /*header*/


      /*content*/
      table {
        border-collapse: collapse;
        width: 100%;
        min-height: calc(100vh - 76px);
      }

      table td {
        vertical-align: top;
        padding: 0;
      }

      table td:nth-child(1) {
        background-color: blue;
        min-width: 150px;
      }

      table td:nth-child(2) {
        background-color: green;
        padding: 10px;
      }

      table td:nth-child(3) {
        background-color: red;
        min-width: 150px;
      }

      @media (max-width: 600px){
        table td:nth-child(1), table td:nth-child(3) {
          display: none;
        }
      }
    </style>

    <!--Request article-->
    <iron-ajax
      auto
      loading="{{loading}}"
      id='article-loader' 
      url='http://localhost:9090/articles/[[routeData.article]].html' 
      handle-as='json'
      on-request='articleRequest'
      on-response='articleResponse'>
    </iron-ajax>

<!--Static Elements-->
    <app-location route='{{route}}'></app-location>
  <!--Default Route-->
    <app-route
      id='landing-route'
      route='{{route}}'
      pattern='/'
      active='{{landing-active}}'>
    </app-route>
    <app-route
      id='landing-route-alt1'
      route='{{route}}'
      pattern='/index.html'
      active='{{index-active}}'>
    </app-route>
  <!--Article Route-->
    <app-route
      id='article-route'
      route='{{route}}'
      pattern='/articles/:article'
      data='{{routeData}}'
      active='{{article-active}}'>
    </app-route>

<!--Content Elements-->
    <header-element>The Title</header-element>
    <table>
      <tr>
  <!--Left Banner-->
        <td width='10%'>
          <div id='left-banner'>
            
          </div>
        </td>

  <!--Content Section-->
        <td width='80%'>
    <!--Landing Page-->
          <div id='landing-page' hidden='[[_mux_landingPage(index-active, landing-active)]]'>
            <p>This is the landing page</p>
            <a id='internal-link' href='/articles/test'>link to first article</a>
          </div>

    <!--Article Viewer-->
          <article-element hidden="[[!article-active]]" article="[[routeData.article]]" active=[[article-active]]></article-element>
        </td>

  <!--Right Banner-->
        <td width='10%'>
          <div id='right-banner'>
            
          </div>
        </td>
      </tr>
    </table>

  </template>
  <script>

    Polymer({
      is: 'AR_Website-app',

      observers: [
        "articleRequest(routeData.article)"
      ],

      attached: function() {
        console.log('app loaded')
        //this.$$('#test-req').generateRequest();
      },

      articleRequest: function(article) {
        if(this.articleActive){
          this.$$('article-element').clearContent()
          console.log("sending request for article named '"+article+"'")
          this.$$('#article-loader').generateRequest()
        }
      },
      
      articleResponse: function(event) {
        var res = event.detail.response[0]
        this.$$('article-element').content = res.content
      },

      _mux_landingPage: function(index, landing){
        if(index || landing){
          console.log(index+" "+landing)
          return false
        }
        else return true
      }
    });

  </script>
</dom-module>